<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WORDLE</title>
    <link rel="icon" href="./logo.png">
</head>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Megrim&family=Oswald&family=Poppins:wght@300&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Lora:wght@700&display=swap');
        
        *{
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        #maincontainer{
            background-color: rgb(232, 232, 232);
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }

        #stback{
            width: 100vw;
            height: 100vh;
            position: fixed;
            background-color: #00000056;
            transition: 0.3s;
        }
        #stback.hidden{visibility: hidden; opacity: 0;}
        #stback.show{visibility: visible; opacity: 1;}

        #stcontainer{
            z-index: 30;
            width: 80vw;
            height: 420px;
            background-color: rgb(241, 241, 241);
            border-radius: 10px;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #454545;
            transition:  0.3s;
        }

        #stcontainer.hidden{transform: translate(-50%, calc(-50% + 100px)); opacity: 0;}
        #stcontainer.show{transform: translate(-50%, -50%); opacity: 1;}

        #stclose{
            position: absolute;
            top: 7px;
            right: 7px;
            font-size: 1.5em;
        }

        #stp{
            width: 70%;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            color: #454545;
        }

        #stothers{
            border-top: #454545 solid 1px;
            width: 70%;
            height: 50%;
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
            color: #454545;
        }

        .stparameters{
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            color: #454545;
        }

        #navbar{
            background-color: #70bdb9;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            width: 100vw;
            height: 55px;
        }

        #title{
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        #navbartools{
            height: 100%;
        }

        ion-icon{
            font-size: 2em;
        }

        #container{
            border-radius: 4px;
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 9px;
            padding: 9px;
            align-items: center;
            justify-content: center;
        }

        .box{
            background-color: rgb(254, 254, 254);
            color: #454545;
            width: 15vw;
            height: 15vw;
            border-radius: 3px;
            border: #cecece solid 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Lora', serif;
            font-size: 2.25rem;
            transition: 0.2s;
        }

        .box.win{
            transform: scale(1.4) rotateX(90deg);
        }

        .box.reload{
            transform: scale(0);
        }

        #keyboard{
            width: 100vw;
            background-color: rgb(205 205 205);
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            padding: 15px;
        }

        .kbutton{
            height: 7vh;
            font-size: 1.25rem;
            font-weight: 600;
            border: none;
            border-radius: 3px;
            background-color: rgb(250, 250, 250);
            color: rgb(69, 69, 69);
            transition: 0.2s;
        }

        .kbutton.click{
            transform: scale(1.5);
        }

        #b↵{
            grid-column: 1/3;
            font-size: 2rem;
        }

    </style>
<body>
    <div id="maincontainer">
        <div id="stback" class="hidden">
            <div id="stcontainer" class="hidden">
                <ion-icon name="close" id="stclose" onclick="stclose()">x</ion-icon>
                <h1 id="sttitle">{ Statistics } </h1>
                <h1 id="stp">0%</h1>
                <div id="stothers">
                    <div class="stparameters">Played<span id="stplayed">0</span></div>
                    <div class="stparameters">Wins<span id="stwins">0</span></div>
                    <div class="stparameters">Loses<span id="stloses">0</span></div>
                    <div class="stparameters">Current Streak<span id="stcurrent">0</span></div>
                    <div class="stparameters">Max Streak<span id="ststreak">0</span></div>
                </div>
            </div>
        </div>
        <div id="navbar">
            <ion-icon name="refresh" onclick="reload()"></ion-icon>
            <h2 id="title">WORDLE</h2>
            <div id="navbartools">
                <ion-icon name="attach" onclick="copy()"></ion-icon>
                <ion-icon name="stats" onclick="statistics()"></ion-icon>
            </div>
        </div>
        <div id="container"></div>
        <div id="keyboard"></div>
    </div>
    <script src="/wordlist.js"></script>
    <script>
        //statistics parameters
        const span_stp = document.querySelector("#stp")
        const span_played = document.querySelector("#stplayed")
        const span_wins = document.querySelector("#stwins")
        const span_loses = document.querySelector("#stloses")
        const span_current_streak = document.querySelector("#stcurrent")
        const span_streak = document.querySelector("#ststreak")

        let played = 0
        let wins = 0
        let loses = 0
        let current_streak = 0
        let streak = 0
        

        let running = true
        const rows = 6
        const columns = 5
        const container = document.querySelector("#container");
        const keyboard = document.querySelector("#keyboard");
        const keyboard_array = "qwertyuiopasdfghjklñ↵zxcvbnm-";
        function createGrid(){
            let array = []
            for(let i = 0; i < 6; i++){
                array.push([])
                for(let e = 0; e < 5; e++){
                    array[i].push({value: "", state: "n"})//state n / is / right / wrong
                }
            }
            return array
        }
        let level_set = createGrid()    
        let level = 0
        let word = []


        for(let i = 0; i < rows * columns; i++){
            new_div = document.createElement("div");
            new_div.setAttribute("class", "box")
            new_div.classList.add(i)
            container.appendChild(new_div);
        }
        container.style.setProperty("grid-template-columns","repeat("+columns+", 1fr)")

        for(let i = 0; i < keyboard_array.length; i++){
            new_button = document.createElement("button");
            new_button.innerText = keyboard_array[i];
            new_button.setAttribute("data-key", keyboard_array[i]);
            new_button.setAttribute("id", "b"+ keyboard_array[i]);
            new_button.setAttribute("class", "kbutton");
            keyboard.appendChild(new_button);
        }

        document.querySelectorAll(".kbutton").forEach(x => {
            x.onclick = () => {
                x.classList.toggle("click");
                setTimeout(() => {
                    x.classList.toggle("click");
                }, 100);
                if (word.length < 5 && running) {
                    word.push(x.innerText)
                    fillblank()
                    draw()
                }
            }
        });

        document.querySelector("#b↵").onclick = () => {
            if (running){
                if (word.length == columns) {
                    CheckWord(word)
                    word = []
                    draw()
                }
                if (!running){
                    set_parameters(true);
                    animate_box("win");
                }
                if (level == 6 && running){
                    setTimeout(()=>{
                        alert("The word is " + cword)  
                    }, 500)       
                    set_parameters(false);  
                    running = false;   
                }
            }
        }

        document.querySelector("#b-").onclick = () => {
            if (word.length > 0){
                word.pop()
                fillblank()
                draw()
            }
        }

        function CheckWord(array){
            if (word_list.includes(array.join(""))){
                for(let i = 0; i < 5; i++){
                    leter = array[i]
                    button = document.querySelector("#b"+ array[i])
                    if (leter == cword[i]){
                        level_set[level][i].state = "r"
                    }else if (cword.includes(leter)){
                        level_set[level][i].state = "i"
                    }else{
                        level_set[level][i].state = "w"
                        set_style(button,"#454545","#fcfcfc")
                    }
                }
                level ++;
            }else{
                alert("WORDLE does not recognize this word")
                for(let i = 0; i < 5; i++){
                    level_set.level[level][i].value = ""
                }
            }
            if (array.join("") == cword){
                running = false;
            }
        }

        function animate_box(c){
            document.querySelectorAll(".box").forEach(x => {
                setTimeout(() => {
                    x.classList.toggle(c);
                }, 50*x.classList[1]);
                setTimeout(() => {
                    x.classList.toggle(c);
                }, (50*x.classList[1])+500)
            })
        }


        function draw(){
            itr = 0
            for(let i = 0; i < 6; i++){
                for(let e = 0; e < 5; e++){
                    box = document.querySelectorAll(".box")[itr]
                
                    box.innerText = level_set[i][e].value
                    state = level_set[i][e].state                    
                    set_color(state)
                    itr ++;
                }
            }
        }

        function set_color(state){
            b = "#fcfcfc"
            f = "#454545"
            if (state == "r"){
                b = "#70bdb9"
                f = "#fcfcfc"
            }else if (state == "i"){
                b = "#ffe44c"
                f = "#fcfcfc"
            }else if (state == "w"){
                b = "#454545"
                f = "#fcfcfc"
            }
            set_style(box, b, f)
        }

        function set_style(object, backcolor, color){
            object.style.setProperty("background-color", backcolor)
            object.style.setProperty("color", color)
        }

        function fillblank(){
            for (let i = 0; i < 5; i++){
                if (word[i] == undefined){
                    r = ""
                }else{
                    r = word[i]
                }
                level_set[level][i].value = r
            }
        }

        function set_parameters(x){
            played ++;
            if (x){
                wins ++;
                current_streak ++;
            }else{
                loses ++;
                current_streak = 0;
            }
            if (current_streak > streak){
                streak = current_streak;
            }
        }

        const reload = ()=> {
            running = true;
            level_set =  createGrid();
            level = 0
            word = []
            cword = word_list[Math.floor(Math.random()*word_list.length)]
            animate_box("reload");
            document.querySelectorAll(".box").forEach(x => {
                setTimeout(() => {
                    set_style(x,"#fcfcfc","#454545");
                    x.innerText = ""
                }, 50*x.classList[1]);
            })
            document.querySelectorAll(".kbutton").forEach(x => {
                set_style(x,"#fcfcfc","#454545")
            })
        }

        const copy = ()=> {
            emo = ["🟩","🟨","⬛","⬜"]
            let text = []
            let extra = 0
            for(let i = 0; i < 6; i++){
                for(let e = 0; e < 5; e++){
                    state = level_set[i][e].state
                    if (state == "r"){
                        text.push(emo[0])
                    }else if (state == "i"){
                        text.push(emo[1])
                    }else if (state == "w"){
                        text.push(emo[2])
                    }else{
                        text.push(emo[3])
                    }

                    if ((text.length - extra) % 5 == 0){
                        text.push("\n")
                        extra ++
                    }
                }
            }
            let ftext = text.join("");
            navigator.clipboard.writeText(ftext);
            alert("copied in clipboard!!!")
        }

        const statistics = ()=> {
            if (played > 0){
                span_stp.innerText = (((wins/played)*100).toFixed(1)+"%")
            } else {
                span_stp.innerText = "0.0%"
            }
            span_played.innerText = played
            span_wins.innerText = wins
            span_loses.innerText = loses
            span_current_streak.innerText = current_streak
            span_streak.innerText = streak
            stclose();
        }
        
        const stclose = ()=> {
            document.querySelector("#stback").classList.toggle("show");
            document.querySelector("#stcontainer").classList.toggle("show");
        }

    </script>
    <script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>
</body>
</html>